
stages:
- build
- deploy

variables:
  GCP_PROJECT_NAME: moss-work
  GCP_REGION: europe-west1
  CLUSTER_NAME: mw-prod
  GOOGLE_CREDENTIALS: $BUILD_KEY
  NAMESPACE: mosstech
  APP_NAME: mosstech
  DOMAIN: mosstech.io
  ALT_DOMAIN: alexos.io

build:
  stage: build
  image: registry.gitlab.com/mosstech/mw-platform/mw-builder
  variables:
    DOCKER_HOST: tcp://docker:2375/
    DOCKER_DRIVER: overlay2
  services:
  - docker:dind
  only:
  - master
  script: 
  - ./go build

deploy:
  stage: deploy
  image: registry.gitlab.com/mosstech/mw-platform/mw-builder
  dependencies:
  - build
  only:
  - master
  script:
  - ./go deploy
